"use strict";var strings=[];strings.es={nav:{short_title:"Zaragoza",title:"Descubre la ciudad",child:"Infancia",young:"Jóvenes",elder:"Personas Mayores",gastronomy:"Gastronomía",accommodation:"Alojamiento",events:"Actividades",resources:"Recursos",agenda:"Agenda",search:"Buscar"},index:{events:"Actividades destacadas",monuments:"Monumentos destacados"},facet:{clear:"Borrar filtro"},search:{result:"Resultado",query:"Consulta"},sector:{youth:{menu:[{opt:"marcha",text:"Zonas Marcha",uri:"/recurso/mapas-colaborativos/134?srsname=wgs84&rows=200"},{opt:"noche",text:"Noche",uri:"/recurso/mapas-colaborativos/125?srsname=wgs84&rows=200"},{opt:"tomar",text:"Tomar Algo",uri:"/recurso/mapas-colaborativos/135?srsname=wgs84&rows=200"},{opt:"envivo",text:"Música en vivo",uri:"/recurso/mapas-colaborativos/137?srsname=wgs84&rows=200"},{opt:"zonasverdes",text:"Zonas verdes",uri:"/recurso/mapas-colaborativos/139?srsname=wgs84&rows=200"},{opt:"compras",text:"De compras",uri:"/recurso/mapas-colaborativos/131?srsname=wgs84&rows=200"},{opt:"tapas",text:"De tapas",uri:"/recurso/mapas-colaborativos/130?srsname=wgs84&rows=200"},{opt:"ocio",text:"Ocio",uri:"/recurso/mapas-colaborativos/136?srsname=wgs84&rows=200"}]}},detail:{near:"Cerca de aquí",addAgenda:"Añadir a agenda",events:"Actividades",monuments:"Monumentos",gastronomy:"Restaurantes",accommodation:"Alojamientos",health:"Sanidad",resources:"Recursos",parking_bike:"Aparcabicis",bizi:"Bizi",taxi:"Taxis",public_parking:"Aparcamientos Públicos",motorcycle_parking:"Aparcamientos para motos",filling_station:"Gasolineras",label:{size:"Capacidad",web_site:"Sitio Web",phone:"Teléfono",fax:"Fax",email:"Mail",address:"Dirección",postal_code:"Código postal",program:"Programa",start_date:"Fecha inicio",end_date:"Fecha fin",start_time:"Hora inicio",end_time:"Hora fin",opening_hours:"Horario",accession:"Tipo de entrada",price:"Precio",capacity:"Número máximo de participantes",use:"Uso",pois:"Puntos de interés",visit:"Visita",access:"Acceso",foursquare:"Foursquare",near:"Cerca de aquí"},more:"Más"}};var query={search:'SELECT DISTINCT ?uri ?title min(?latitud) as ?latitud min(?longitud) as ?longitud         WHERE {          ?uri ?s  ?p.          ?uri rdfs:label  ?title.          ?uri geo:geometry ?geo.          ?geo geo:lat ?latitud.          ?geo geo:long ?longitud.          FILTER (REGEX(STR(?p), "{0}", "i"))         } group by ?uri ?title         OFFSET {1} LIMIT 50',filter:{evento:'SELECT distinct ?uri ?title ?latitud ?tipo ?subEvent ?longitud ?modified ?comment ?price ?accesible ?accesibilidad ?programa ?image ?maxParticipantes ?startDate ?endDate ?startTime ?endTime ?horario ?url                WHERE { ?uri a <http://vocab.linkeddata.es/datosabiertos/def/cultura-ocio/agenda#Evento>.                OPTIONAL {?uri rdfs:label  ?title.}                OPTIONAL {?uri dcterms:modified  ?modified.}                OPTIONAL {?uri rdfs:comment  ?comment.}                OPTIONAL {?uri <http://schema.org/price>  ?price.}                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/cultura-ocio/agenda#accesible>  ?accesible.}                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/cultura-ocio/agenda#programa>  ?programa.}                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/cultura-ocio/agenda#tipoEntrada>  ?tipoEntrada.}                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/cultura-ocio/agenda#numMaximoParticipantes>  ?maxParticipantes.}                OPTIONAL {?uri <http://www.w3.org/2006/vcard/ns#category>  ?tipo.}                OPTIONAL {?uri <http://schema.org/subEvent> ?subEvent.}                OPTIONAL {?subEvent <http://schema.org/startDate> ?startDate.}                OPTIONAL {?subEvent <http://schema.org/endDate> ?endDate.}                OPTIONAL {?subEvent <http://schema.org/startTime> ?startTime.}                OPTIONAL {?subEvent <http://schema.org/endTime> ?endTime.}                OPTIONAL {?subEvent <http://schema.org/openingHours> ?horario.}                OPTIONAL {?uri <http://schema.org/image>  ?image.}                OPTIONAL {?uri <http://schema.org/url>  ?url.}                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/cultura-ocio/agenda#barrerasArquitectonicas>  ?accesibilidad.}                OPTIONAL {?uri geo:geometry ?geo.                ?geo geo:lat ?latitud.                ?geo geo:long ?longitud}.                ?uri dcterms:identifier "{0}".                }',alojamiento:'PREFIX locn: <http://www.w3.org/ns/locn#>                SELECT distinct ?uri ?title ?latitud ?longitud ?modified ?tel ?fax ?comment ?accesibilidad ?numCamas ?numHabitaciones ?streetAdr ?addressLocality ?postCode ?email ?socioHoreca ?categoria ?logo ?photo ?url                WHERE { ?uri a <http://vocab.linkeddata.es/kos/turismo/alojamiento>.                OPTIONAL {?uri rdfs:label  ?title.}                OPTIONAL {?uri dcterms:modified  ?modified.}                OPTIONAL {?uri rdfs:comment  ?comment.}                OPTIONAL {?uri s:addressLocality  ?addressLocality.}                OPTIONAL {?uri locn:postCode  ?postCode.}                OPTIONAL {?uri <http://schema.org/email>  ?email.}                OPTIONAL {?uri <http://www.w3.org/2006/vcard/ns#logo>  ?logo.}                OPTIONAL {?uri <http://www.w3.org/2006/vcard/ns#photo>  ?photo.}                OPTIONAL {?uri <http://www.w3.org/2006/vcard/ns#url>  ?url.}                OPTIONAL {?uri <http://www.w3.org/2006/vcard/ns#street-adr>  ?streetAdr.}                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/turismo/alojamiento#numCamas>  ?numCamas.}                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/turismo/alojamiento#numHabitaciones>  ?numHabitaciones.}                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/turismo/lugar#accesibilidad>  ?accesibilidad.}                OPTIONAL {?uri <http://www.zaragoza.es/api/def/turismo/lugar#socioHoreca>  ?socioHoreca.}                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/turismo/alojamiento#categoria> ?categoria.}                OPTIONAL {?uri <http://schema.org/telephone> ?tel.}                OPTIONAL {?uri <http://schema.org/faxNumber> ?fax.}                OPTIONAL {?uri geo:geometry ?geo.                ?geo geo:lat ?latitud.                ?geo geo:long ?longitud}.                ?uri dcterms:identifier "{0}".                }',restaurante:'PREFIX locn: <http://www.w3.org/ns/locn#>                SELECT distinct ?uri ?title ?latitud ?longitud ?modified ?tel ?comment ?accesibilidad ?servesCuisine ?tenedores ?capacidad ?streetAdr ?addressLocality ?postCode ?email ?socioHoreca ?restauranteEnHotel ?fincaCatering ?locality ?logo ?photo ?url                WHERE { ?uri a <http://vocab.linkeddata.es/kos/turismo/restaurante>.                OPTIONAL {?uri rdfs:label  ?title.}                OPTIONAL {?uri dcterms:modified  ?modified.}                OPTIONAL {?uri rdfs:comment  ?comment.}                OPTIONAL {?uri s:addressLocality  ?addressLocality.}                OPTIONAL {?uri locn:postCode  ?postCode.}                OPTIONAL {?uri <http://www.w3.org/2006/vcard/ns#email>  ?email.}                OPTIONAL {?uri <http://www.w3.org/2006/vcard/ns#logo>  ?logo.}                OPTIONAL {?uri <http://www.w3.org/2006/vcard/ns#photo>  ?photo.}                OPTIONAL {?uri <http://www.w3.org/2006/vcard/ns#url>  ?url.}                OPTIONAL {?uri <http://www.w3.org/2006/vcard/ns#street-adr>  ?streetAdr.}                OPTIONAL {?uri <http://www.zaragoza.es/skos/vocab/capacidad>  ?capacidad.}                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/turismo/lugar#accesibilidad>  ?accesibilidad.}                OPTIONAL {?uri <http://www.zaragoza.es/skos/vocab/restauranteEnHotel>  ?restauranteEnHotel.}                OPTIONAL {?uri <http://www.zaragoza.es/api/def/turismo/lugar#socioHoreca>  ?socioHoreca.}                OPTIONAL {?uri <http://schema.org/servesCuisine> ?servesCuisine.}                OPTIONAL {?uri <http://www.zaragoza.es/skos/vocab/fincaCatering> ?fincaCatering.}                OPTIONAL {?uri <http://www.w3.org/2006/vcard/ns#tel> ?telin.                    ?telin <http://www.w3.org/2006/vcard/ns#Tel> ?tel.                }                OPTIONAL {?uri geo:geometry ?geo.                ?geo geo:lat ?latitud.                ?geo geo:long ?longitud}.                ?uri dcterms:identifier "{0}".                }',monumento:'SELECT distinct ?uri ?title ?latitud ?longitud ?modified ?tel ?fax ?comment ?foursquare ?datacion ?uso ?datosAcceso ?estilo ?puntosInteres ?streetAdr ?horario ?price ?detalleVisita ?photo                 WHERE { ?uri a <http://vocab.linkeddata.es/datosabiertos/def/turismo/lugar#LugarInteresTuristico>.                OPTIONAL {?uri rdfs:label  ?title.}                OPTIONAL {?uri dcterms:modified  ?modified.}                OPTIONAL {?uri rdfs:comment  ?comment.}                OPTIONAL {?uri <http://www.w3.org/2006/vcard/ns#photo>  ?photo.}                OPTIONAL {?uri <http://schema.org/streetAddress>  ?streetAdr.}                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/turismo/lugar#estiloArtistico>  ?estilo.}                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/turismo/lugar#puntosInteres>  ?puntosInteres.}                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/turismo/lugar#datacion>  ?datacion.}                OPTIONAL {?uri <http://schema.org/price>  ?price.}                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/turismo/lugar#uso>  ?uso.}                OPTIONAL {?uri <http://schema.org/openingHours>  ?horario.}                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/turismo/lugar#foursquare>  ?foursquare.}                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/turismo/lugar#datosAcceso> ?datosAcceso.}                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/turismo/lugar#detalleVisita> ?detalleVisita.}                OPTIONAL {?uri <http://schema.org/telephone> ?tel.}                OPTIONAL {?uri <http://schema.org/faxNumber> ?fax.}                OPTIONAL {?uri geo:geometry ?geo.                ?geo geo:lat ?latitud.                ?geo geo:long ?longitud}.                ?uri dcterms:identifier "{0}".                }',recurso:'SELECT distinct ?uri ?title ?latitud ?longitud ?modified ?tel ?email ?url ?comment ?servicios ?accesibilidad ?streetAdr ?horario ?price                  WHERE { ?uri a <http://vocab.linkeddata.es/kos/urbanismo-infraestructuras/equipamiento>.                OPTIONAL {?uri rdfs:label  ?title.}                OPTIONAL {?uri dcterms:modified  ?modified.}                OPTIONAL {?uri rdfs:comment  ?comment.}                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/turismo/lugar#servicios> ?servicios.}                OPTIONAL {?uri <http://schema.org/streetAddress>  ?streetAdr.}                OPTIONAL {?uri <http://purl.org/goodrelations/v1#hasOpeningHoursSpecification>  ?horario.}                OPTIONAL {?uri <http://www.w3.org/2006/vcard/ns#tel> ?telin.                    ?telin <http://www.w3.org/2006/vcard/ns#Tel> ?tel.                }                OPTIONAL {?uri <http://www.w3.org/2006/vcard/ns#email> ?email.}                OPTIONAL {?uri <http://www.w3.org/2006/vcard/ns#url> ?url.}                OPTIONAL {?uri <http://schema.org/price> ?price.}                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/turismo/lugar#accesibilidad> ?accesibilidad.}                OPTIONAL {?uri geo:geometry ?geo.                ?geo geo:lat ?latitud.                ?geo geo:long ?longitud}.                ?uri dcterms:identifier "{0}".                }'},index:{actividades:'PREFIX acto: <http://vocab.linkeddata.es/datosabiertos/def/cultura-ocio/agenda#>            SELECT DISTINCT ?uri ?title ?startDate ?endDate ?startTime ?endTime ?horario ?tipo min(?latitud) as ?latitud min(?longitud) as ?longitud             WHERE { ?uri a acto:Evento.                OPTIONAL{ ?uri rdfs:label  ?title}.               OPTIONAL {?uri <http://schema.org/subEvent> ?subEvent.}               OPTIONAL {?subEvent <http://schema.org/startDate> ?startDate.}               OPTIONAL {?subEvent <http://schema.org/endDate> ?endDate.}               OPTIONAL {?subEvent <http://schema.org/startTime> ?startTime.}               OPTIONAL {?subEvent <http://schema.org/endTime> ?endTime.}               OPTIONAL {?subEvent <http://schema.org/openingHours> ?horario.}               OPTIONAL {?uri <http://www.w3.org/2006/vcard/ns#category>  ?tipoInt.}               OPTIONAL {?tipoInt <http://www.w3.org/2004/02/skos/core#prefLabel>  ?tipo.}               OPTIONAL {?uri geo:geometry ?geo.                     ?geo geo:lat ?latitud.                     ?geo geo:long ?longitud.}               ?uri acto:destacada "true".               ?uri acto:orden ?orden.            } group by ?uri ?title ?startDate ?endDate ?startTime ?endTime ?horario ?tipo ?orden             ORDER BY ASC(?orden) LIMIT 20',monumentos:'PREFIX monumento: <http://vocab.linkeddata.es/datosabiertos/def/turismo/lugar#>            SELECT DISTINCT ?uri ?title ?tipo min(?latitud) as ?latitud min(?longitud) as ?longitud             WHERE { ?uri a monumento:LugarInteresTuristico.                OPTIONAL{ ?uri rdfs:label  ?title}.               ?uri monumento:estiloArtistico ?tipo.                ?uri monumento:destacado "S".               OPTIONAL {?uri geo:geometry ?geo.                     ?geo geo:lat ?latitud.                     ?geo geo:long ?longitud.}            } group by ?uri ?title ?tipo'},faceta:{events:{query:"PREFIX acto: <http://vocab.linkeddata.es/datosabiertos/def/cultura-ocio/agenda#>             SELECT DISTINCT ?uri ?title ?startDate ?endDate ?startTime ?endTime ?horario ?tipo min(?latitud) as ?latitud min(?longitud) as ?longitud             WHERE { ?uri a acto:Evento.                OPTIONAL{ ?uri rdfs:label ?title}.                OPTIONAL {?uri <http://schema.org/subEvent> ?subEvent.}                OPTIONAL {?subEvent <http://schema.org/startDate> ?startDate.}                OPTIONAL {?subEvent <http://schema.org/endDate> ?endDate.}                OPTIONAL {?subEvent <http://schema.org/startTime> ?startTime.}                OPTIONAL {?subEvent <http://schema.org/endTime> ?endTime.}                OPTIONAL {?subEvent <http://schema.org/openingHours> ?horario.}                OPTIONAL {?uri <http://www.w3.org/2006/vcard/ns#category>  ?tipoInt.}                OPTIONAL {?tipoInt <http://www.w3.org/2004/02/skos/core#prefLabel>  ?tipo.}                OPTIONAL {?uri geo:geometry ?geo.                     ?geo geo:lat ?latitud.                     ?geo geo:long ?longitud.}             	bind (coalesce(xsd:date(?startDate), now()) as ?startAsDate) 				bind(if(?startAsDate < now(), now(), ?startAsDate) AS ?startFixed)             	bind (coalesce(xsd:date(?endDate), now()) as ?endFixed)             	bind(bif:dateDiff('day',?startFixed,?endFixed) as ?diff) 				filter(?diff >= 0) . 				{0}             }             group by ?uri ?title ?startDate ?endDate ?startTime ?endTime ?horario ?tipo ?startFixed ?diff             order by asc(?startFixed) asc(?diff)",facet:"SELECT ?urifaceta ?faceta COUNT(?faceta) as ?numero             WHERE { ?uri a <http://vocab.linkeddata.es/datosabiertos/def/cultura-ocio/agenda#Evento>.                     ?uri <http://www.w3.org/2006/vcard/ns#category> ?urifaceta.                     ?urifaceta <http://www.w3.org/2004/02/skos/core#prefLabel> ?faceta.                     {0}            }             GROUP BY ?urifaceta ?faceta"},gastronomy:{query:'SELECT DISTINCT ?uri ?title ?tipo min(?latitud) as ?latitud min(?longitud) as ?longitud             WHERE { ?uri a <http://vocab.linkeddata.es/kos/turismo/restaurante>.                OPTIONAL{ ?uri rdfs:label  ?title}.                OPTIONAL {?uri <http://www.zaragoza.es/skos/vocab/tenedores> ?tenedores.}                bind(if(bound(?tenedores),concat(?tenedores," tenedor(es)"),"Restaurante") as ?tipo) .                {0}                OPTIONAL {?uri geo:geometry ?geo.                     ?geo geo:lat ?latitud.                     ?geo geo:long ?longitud.}             } group by ?uri ?title ?tipo             order by desc(?tipo)',facet:'SELECT ?faceta COUNT(?faceta) as ?numero             WHERE { ?uri a <http://vocab.linkeddata.es/kos/turismo/restaurante>.                 optional{?uri <http://www.zaragoza.es/skos/vocab/tenedores> ?tenedores.} 				bind(if(bound(?tenedores),concat(?tenedores," tenedor(es)"),"Restaurante") as ?faceta) . 				{0}             }             GROUP BY ?faceta'},accommodation:{query:"PREFIX locn: <http://www.w3.org/ns/locn#>             SELECT DISTINCT ?uri ?title ?tipo min(?latitud) as ?latitud min(?longitud) as ?longitud             WHERE { ?uri a <http://vocab.linkeddata.es/kos/turismo/alojamiento>.                OPTIONAL{ ?uri rdfs:label  ?title}.                OPTIONAL {?uri <http://vocab.linkeddata.es/datosabiertos/def/turismo/alojamiento#categoria> ?tipo.}                OPTIONAL {?uri geo:geometry ?geo.                     ?geo geo:lat ?latitud.                     ?geo geo:long ?longitud.}                {0}             } group by ?uri ?title ?tipo             order by desc(?tipo)",facet:"SELECT ?faceta COUNT(?faceta) as ?numero                 WHERE { ?uri a <http://vocab.linkeddata.es/kos/turismo/alojamiento>.                 ?uri <http://vocab.linkeddata.es/datosabiertos/def/turismo/alojamiento#categoria> ?faceta.                 {0}                }                 GROUP BY ?faceta"}},sector:{events:"PREFIX acto: <http://vocab.linkeddata.es/datosabiertos/def/cultura-ocio/agenda#>            SELECT DISTINCT ?uri ?title ?startDate ?endDate ?startTime ?endTime ?horario ?tipo min(?latitud) as ?latitud min(?longitud) as ?longitud            WHERE { ?uri a acto:Evento.                OPTIONAL{ ?uri rdfs:label  ?title}.               OPTIONAL {?uri <http://schema.org/subEvent> ?subEvent.}               OPTIONAL {?subEvent <http://schema.org/startDate> ?startDate.}               OPTIONAL {?subEvent <http://schema.org/endDate> ?endDate.}               OPTIONAL {?subEvent <http://schema.org/startTime> ?startTime.}               OPTIONAL {?subEvent <http://schema.org/endTime> ?endTime.}               OPTIONAL {?subEvent <http://schema.org/openingHours> ?horario.}               OPTIONAL {?uri <http://www.w3.org/2006/vcard/ns#category>  ?tipoInt.}               OPTIONAL {?tipoInt <http://www.w3.org/2004/02/skos/core#prefLabel>  ?tipo.}               OPTIONAL {?uri geo:geometry ?geo.                     ?geo geo:lat ?latitud.                     ?geo geo:long ?longitud.}               ?uri <http://schema.org/typicalAgeRange> <http://www.zaragoza.es/api/recurso/cultura-ocio/poblacion-destinataria/evento-zaragoza/{0}>             }            group by ?uri ?title ?startDate ?endDate ?startTime ?endTime ?horario ?tipo             order by ?startDate",resources:'SELECT ?uri ?title ?tipo min(?latitud) as ?latitud min(?longitud) as ?longitud            {                SELECT DISTINCT ?uri ?title (group_concat(distinct ?tipo;separator=",")) as ?tipo ?latitud ?longitud                  WHERE { ?uri a <http://vocab.linkeddata.es/kos/urbanismo-infraestructuras/equipamiento>.                       OPTIONAL{ ?uri rdfs:label  ?title}.                       ?uri <http://www.w3.org/2006/vcard/ns#category> ?tipoInt.                       ?tipoInt rdfs:label ?tipo.                       OPTIONAL {?uri geo:geometry ?geo.                         ?geo geo:lat ?latitud.                         ?geo geo:long ?longitud.}                      ?uri <http://schema.org/typicalAgeRange> <http://www.zaragoza.es/api/recurso/clase-persona/{0}>                       }                   group by ?uri ?title ?latitud ?longitud                   order by ?title            }group by ?uri ?title ?tipo'}};angular.module("descubre",["ngRoute","ngSanitize","descubre.index","descubre.sector","descubre.facet","descubre.buscar","descubre.version","descubre.services","filtros","ngMaterial","infinite-scroll","descubre.directives","leaflet-directive"]).run(function($rootScope){$rootScope.strings=strings.es,$rootScope.query=query}).config(["$routeProvider","$mdThemingProvider",function($routeProvider,$mdThemingProvider){$mdThemingProvider.theme("default").primaryColor("red").accentColor("green"),console.log($mdThemingProvider.theme("default")),$routeProvider.otherwise({redirectTo:"/index"})}]).controller("MenuCtrl",["$scope","$mdSidenav","$location","Agenda",function($scope,$mdSidenav,$location,Agenda){$scope.openMenu=function(){$mdSidenav("left").open()},$scope.toggleRight=function(){$mdSidenav("right").toggle(),console.log(Agenda.list()),$scope.items=Agenda.list()},$scope.closeRight=function(){$mdSidenav("right").close()},$scope.removeAgenda=function(id,fecha,tipo){Agenda.remove(id,fecha,tipo),$scope.items=Agenda.list()},$scope.updateAgenda=function(id,fecha,tipo){var registro={};registro.uri="http://aasdasd",registro.title="titulo",registro.date="2015-02-25",registro.startTime="16:00",registro.endTime="18:00",Agenda.update(id,fecha,tipo,registro),$scope.items=Agenda.list()}}]).controller("BusquedaCtrl",["$scope","$location",function($scope,$location){$scope.buscar=function(){$location.path("/buscar/"+$scope.consulta)}}]),angular.module("descubre.index",["ngRoute","descubre.services","filtros","ngMaterial","ui.bootstrap","ngSanitize"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/index",{templateUrl:"index/index.html",controller:"IndexCtrl as ctrl"})}]).controller("IndexCtrl",["$scope","Query","Agenda","$filter","$mdSidenav",function($scope,Query,Agenda,$filter,$mdSidenav){$mdSidenav("left").close(),$scope.actividades=[],$scope.monumentos=[],$scope.progresoCarga=0,Query.list(query.index.actividades).then(function(result){$scope.actividades=result.results.bindings,$scope.progresoCarga=$scope.progresoCarga+50}),Query.list(query.index.monumentos).then(function(result){$scope.monumentos=result.results.bindings,$scope.progresoCarga=$scope.progresoCarga+50}),$scope.addCalendar=function(e){alert("asa"),e&&(e.preventDefault(),e.stopPropagation()),Agenda.add($scope.detalle)}}]).controller("DetalleController",["$scope","Query","Agenda","$filter",function($scope,Query,Agenda,$filter){$scope.parquimetrosCercanos=function(){$scope.claseParquimetro="glyphicon glyphicon-refresh",Query.getApi("/recurso/urbanismo-infraestructuras/equipamiento/parquimetro?rows=30&fl=id,title,description,geometry&srsname=wgs84&point="+$scope.detalle.longitud.value+"%2C"+$scope.detalle.latitud.value+"&distance=1000").then(function(resultado){var icono={iconUrl:"//www.zaragoza.es/contenidos/iconos/parquimetro_ESRO.png",iconSize:[22,22]};if($scope.markers={main_marker:{lat:Math.round10($scope.detalle.latitud.value,-4),lng:Math.round10($scope.detalle.longitud.value,-4),focus:!0,message:$scope.detalle.title.value,draggable:!1}},resultado.result&&resultado.result.length>0){$scope.claseParquimetro="";for(var i in resultado.result){var result=resultado.result[i];$scope.markers["rest"+result.id]={lat:Math.round10(result.geometry.coordinates[1],-4),lng:Math.round10(result.geometry.coordinates[0],-4),message:"<strong>"+result.title+"</strong>",icon:icono}}}else $scope.claseParquimetro="glyphicon glyphicon-exclamation-sign"},function(){$scope.claseParquimetro="glyphicon glyphicon-remove-circle"})},$scope.restaurantesCercanos=function(){$scope.claseRestaurante="glyphicon glyphicon-refresh",Query.getApi("/recurso/turismo/restaurante?rows=200&fl=id,title,tenedores,description,geometry&srsname=wgs84&point="+$scope.detalle.longitud.value+"%2C"+$scope.detalle.latitud.value+"&distance=1000").then(function(resultado){var icono={iconUrl:"//www.zaragoza.es/contenidos/iconos/restaurante20.png",iconSize:[22,22]};if($scope.markers={main_marker:{lat:Math.round10($scope.detalle.latitud.value,-4),lng:Math.round10($scope.detalle.longitud.value,-4),focus:!0,message:$scope.detalle.title.value,draggable:!1}},resultado.result&&resultado.result.length>0){$scope.claseRestaurante="";for(var i in resultado.result){var result=resultado.result[i];$scope.markers["rest"+result.id]={lat:Math.round10(result.geometry.coordinates[1],-4),lng:Math.round10(result.geometry.coordinates[0],-4),message:"<strong>"+result.title+(angular.isDefined(result.tenedores)?". <small>Tenedores: "+result.tenedores+"</small>":"")+"</strong><br/>"+result.description,icon:icono}}}else $scope.claseRestaurante="glyphicon glyphicon-exclamation-sign"},function(){$scope.claseRestaurante="glyphicon glyphicon-remove-circle"})},$scope.actosCercanos=function(){$scope.claseActo="glyphicon glyphicon-refresh",Query.getApi("/recurso/cultura-ocio/evento-zaragoza/?rows=200&fl=id,title,start_date,end_date,subEvent,description,geometry&srsname=wgs84&point="+$scope.detalle.longitud.value+"%2C"+$scope.detalle.latitud.value+"&distance=1000").then(function(resultado){var icono={iconUrl:"//www.zaragoza.es/contenidos/iconos/agenda.png",iconSize:[22,22]};if($scope.markers={main_marker:{lat:Math.round10($scope.detalle.latitud.value,-4),lng:Math.round10($scope.detalle.longitud.value,-4),focus:!0,message:$scope.detalle.title.value,draggable:!1}},resultado.result&&resultado.result.length>0){$scope.claseActo="";for(var i in resultado.result){var result=resultado.result[i];$scope.markers["rest"+result.id]={lat:Math.round10(result.geometry.coordinates[1],-4),lng:Math.round10(result.geometry.coordinates[0],-4),message:"<strong>"+result.title+"</strong><div>"+(angular.isDefined(result.subEvent[0].fechaInicio)?"<small>"+$filter("date")(result.subEvent[0].fechaInicio,"dd-MM-yyyy")+"</small>":"")+(angular.isDefined(result.subEvent[0].fechaFinal)?" hasta el <small>"+$filter("date")(result.subEvent[0].fechaFinal,"dd-MM-yyyy")+"</small>":"")+(angular.isDefined(result.subEvent[0].horaInicio)?". <small>"+result.subEvent[0].horaInicio+"</small>":"")+(angular.isDefined(result.subEvent[0].horaFinal)?" - <small>"+result.subEvent[0].horaFinal+"</small>":"")+"</div>"+(angular.isDefined(result.subEvent[0].horario)?"<div>"+result.subEvent[0].horario+"</div>":"")+result.description,icon:icono}}}else $scope.claseActo="glyphicon glyphicon-exclamation-sign"},function(){$scope.claseActo="glyphicon glyphicon-remove-circle"})},$scope.monumentosCercanos=function(){$scope.claseMonumento="glyphicon glyphicon-refresh",Query.getApi("/recurso/turismo/monumento?rows=200&fl=id,title,address,geometry&srsname=wgs84&point="+$scope.detalle.longitud.value+"%2C"+$scope.detalle.latitud.value+"&distance=1000").then(function(resultado){var icono={iconUrl:"//www.zaragoza.es/contenidos/iconos/arte.png",iconSize:[22,22]};if($scope.markers={main_marker:{lat:Math.round10($scope.detalle.latitud.value,-4),lng:Math.round10($scope.detalle.longitud.value,-4),focus:!0,message:$scope.detalle.title.value,draggable:!1}},resultado.result&&resultado.result.length>0){$scope.claseMonumento="";for(var i in resultado.result){var result=resultado.result[i];$scope.markers["monu"+result.id]={lat:Math.round10(result.geometry.coordinates[1],-4),lng:Math.round10(result.geometry.coordinates[0],-4),message:"<strong>"+result.title+"</strong><br/>"+result.address,icon:icono}}}else $scope.claseMonumento="glyphicon glyphicon-exclamation-sign"},function(){$scope.claseMonumento="glyphicon glyphicon-remove-circle"})},$scope.aparcabiciCercanos=function(){$scope.claseAparcabici="glyphicon glyphicon-refresh",Query.getApi("/recurso/urbanismo-infraestructuras/equipamiento/aparcamiento-bicicleta?rows=200&fl=id,title,description,geometry&srsname=wgs84&point="+$scope.detalle.longitud.value+"%2C"+$scope.detalle.latitud.value+"&distance=1000").then(function(resultado){var icono={iconUrl:"//www.zaragoza.es/contenidos/iconos/aparcabicis.png",iconSize:[22,22]};if($scope.markers={main_marker:{lat:Math.round10($scope.detalle.latitud.value,-4),lng:Math.round10($scope.detalle.longitud.value,-4),focus:!0,message:$scope.detalle.title.value,draggable:!1}},resultado.result&&resultado.result.length>0){$scope.claseAparcabici="";for(var i in resultado.result){var result=resultado.result[i];$scope.markers["aloj"+result.id]={lat:Math.round10(result.geometry.coordinates[1],-4),lng:Math.round10(result.geometry.coordinates[0],-4),message:"<strong>"+result.title+"</strong>",icon:icono}}}else $scope.claseAparcabici="glyphicon glyphicon-exclamation-sign"},function(){$scope.claseAparcabici="glyphicon glyphicon-remove-circle"})},$scope.biziCercanos=function(){$scope.claseBizi="glyphicon glyphicon-refresh",Query.getApi("/recurso/urbanismo-infraestructuras/estacion-bicicleta?rows=200&fl=id,title,description,estado,bicisDisponibles,anclajesDisponibles,geometry&srsname=wgs84&point="+$scope.detalle.longitud.value+"%2C"+$scope.detalle.latitud.value+"&distance=1000").then(function(resultado){var icono={iconUrl:"//www.zaragoza.es/contenidos/iconos/estacionesBizi2.png",iconSize:[22,22]};if($scope.markers={main_marker:{lat:Math.round10($scope.detalle.latitud.value,-4),lng:Math.round10($scope.detalle.longitud.value,-4),focus:!0,message:$scope.detalle.title.value,draggable:!1}},resultado.result&&resultado.result.length>0){$scope.claseBizi="";for(var i in resultado.result){var result=resultado.result[i];$scope.markers["aloj"+result.id]={lat:Math.round10(result.geometry.coordinates[1],-4),lng:Math.round10(result.geometry.coordinates[0],-4),message:"<strong>"+result.title+"</strong><br/>"+result.description,icon:icono}}}else $scope.claseBizi="glyphicon glyphicon-exclamation-sign"},function(){$scope.claseBizi="glyphicon glyphicon-remove-circle"})},$scope.alojamientosCercanos=function(){$scope.claseAlojamiento="glyphicon glyphicon-refresh",Query.getApi("/recurso/turismo/alojamiento?rows=200&fl=id,title,description,geometry&srsname=wgs84&point="+$scope.detalle.longitud.value+"%2C"+$scope.detalle.latitud.value+"&distance=1000").then(function(resultado){var icono={iconUrl:"//www.zaragoza.es/contenidos/iconos/alojamiento2.png",iconSize:[22,22]};if($scope.markers={main_marker:{lat:Math.round10($scope.detalle.latitud.value,-4),lng:Math.round10($scope.detalle.longitud.value,-4),focus:!0,message:$scope.detalle.title.value,draggable:!1}},resultado.result&&resultado.result.length>0){$scope.claseAlojamiento="";for(var i in resultado.result){var result=resultado.result[i];$scope.markers["aloj"+result.id]={lat:Math.round10(result.geometry.coordinates[1],-4),lng:Math.round10(result.geometry.coordinates[0],-4),message:"<strong>"+result.title+"</strong><br/>"+result.description,icon:icono}}}else $scope.claseAlojamiento="glyphicon glyphicon-exclamation-sign"},function(){$scope.claseAlojamiento="glyphicon glyphicon-remove-circle"})},$scope.paradaTaxiCercanos=function(){$scope.claseParadaTaxi="glyphicon glyphicon-refresh",Query.getApi("/recurso/urbanismo-infraestructuras/equipamiento/parada-taxi?rows=200&fl=id,title,geometry&srsname=wgs84&point="+$scope.detalle.longitud.value+"%2C"+$scope.detalle.latitud.value+"&distance=1000").then(function(resultado){var icono={iconUrl:"//www.zaragoza.es/contenidos/iconos/paradasdeTaxi.png",iconSize:[22,22]};if($scope.markers={main_marker:{lat:Math.round10($scope.detalle.latitud.value,-4),lng:Math.round10($scope.detalle.longitud.value,-4),focus:!0,message:$scope.detalle.title.value,draggable:!1}},resultado.result&&resultado.result.length>0){$scope.claseParadaTaxi="";for(var i in resultado.result){var result=resultado.result[i];$scope.markers["aloj"+result.id]={lat:Math.round10(result.geometry.coordinates[1],-4),lng:Math.round10(result.geometry.coordinates[0],-4),message:"<strong>"+result.title+"</strong>",icon:icono}}}else $scope.claseParadaTaxi="glyphicon glyphicon-exclamation-sign"},function(){$scope.claseParadaTaxi="glyphicon glyphicon-remove-circle"})},$scope.motoCercanos=function(){$scope.claseMoto="glyphicon glyphicon-refresh",Query.getApi("/recurso/urbanismo-infraestructuras/equipamiento/aparcamiento-moto?rows=200&fl=id,title,geometry&srsname=wgs84&point="+$scope.detalle.longitud.value+"%2C"+$scope.detalle.latitud.value+"&distance=1000").then(function(resultado){var icono={iconUrl:"//www.zaragoza.es/contenidos/iconos/estacionamiento_motos.png",iconSize:[22,22]};
if($scope.markers={main_marker:{lat:Math.round10($scope.detalle.latitud.value,-4),lng:Math.round10($scope.detalle.longitud.value,-4),focus:!0,message:$scope.detalle.title.value,draggable:!1}},resultado.result&&resultado.result.length>0){$scope.claseMoto="";for(var i in resultado.result){var result=resultado.result[i];$scope.markers["aloj"+result.id]={lat:Math.round10(result.geometry.coordinates[1],-4),lng:Math.round10(result.geometry.coordinates[0],-4),message:"<strong>"+result.title+"</strong>",icon:icono}}}else $scope.claseMoto="glyphicon glyphicon-exclamation-sign"},function(){$scope.claseMoto="glyphicon glyphicon-remove-circle"})},$scope.gasolineraCercanos=function(){$scope.claseGasolinera="glyphicon glyphicon-refresh",Query.getApi("/recurso/urbanismo-infraestructuras/equipamiento/estacion-servicio?rows=200&fl=id,title,geometry&srsname=wgs84&point="+$scope.detalle.longitud.value+"%2C"+$scope.detalle.latitud.value+"&distance=1000").then(function(resultado){var icono={iconUrl:"//www.zaragoza.es/contenidos/iconos/estacionServicio.png",iconSize:[22,22]};if($scope.markers={main_marker:{lat:Math.round10($scope.detalle.latitud.value,-4),lng:Math.round10($scope.detalle.longitud.value,-4),focus:!0,message:$scope.detalle.title.value,draggable:!1}},resultado.result&&resultado.result.length>0){$scope.claseGasolinera="";for(var i in resultado.result){var result=resultado.result[i];$scope.markers["aloj"+result.id]={lat:Math.round10(result.geometry.coordinates[1],-4),lng:Math.round10(result.geometry.coordinates[0],-4),message:"<strong>"+result.title+"</strong>",icon:icono}}}else $scope.claseGasolinera="glyphicon glyphicon-exclamation-sign"},function(){$scope.claseGasolinera="glyphicon glyphicon-remove-circle"})},$scope.sanidadCercanos=function(){$scope.claseSanidad="glyphicon glyphicon-refresh",Query.getApi("/recurso/urbanismo-infraestructuras/equipamiento/recurso/?q=subtemas.id==781,subtemas.id==780&rows=200&fl=id,title,geometry&srsname=wgs84&point="+$scope.detalle.longitud.value+"%2C"+$scope.detalle.latitud.value+"&distance=1000").then(function(resultado){var icono={iconUrl:"//www.zaragoza.es/contenidos/iconos/sanidadYconsumo.png",iconSize:[22,22]};if($scope.markers={main_marker:{lat:Math.round10($scope.detalle.latitud.value,-4),lng:Math.round10($scope.detalle.longitud.value,-4),focus:!0,message:$scope.detalle.title.value,draggable:!1}},resultado.result&&resultado.result.length>0){$scope.claseSanidad="";for(var i in resultado.result){var result=resultado.result[i];$scope.markers["aloj"+result.id]={lat:Math.round10(result.geometry.coordinates[1],-4),lng:Math.round10(result.geometry.coordinates[0],-4),message:"<strong>"+result.title+"</strong>",icon:icono}}}else $scope.claseSanidad="glyphicon glyphicon-exclamation-sign"},function(){$scope.claseSanidad="glyphicon glyphicon-remove-circle"})},$scope.aparcamientoCercanos=function(){$scope.claseAparcamiento="glyphicon glyphicon-refresh",Query.getApi("/recurso/urbanismo-infraestructuras/equipamiento/aparcamiento-publico?rows=200&fl=id,title,geometry&srsname=wgs84&point="+$scope.detalle.longitud.value+"%2C"+$scope.detalle.latitud.value+"&distance=1000").then(function(resultado){var icono={iconUrl:"//www.zaragoza.es/contenidos/iconos/aparcamientos.png",iconSize:[22,22]};if($scope.markers={main_marker:{lat:Math.round10($scope.detalle.latitud.value,-4),lng:Math.round10($scope.detalle.longitud.value,-4),focus:!0,message:$scope.detalle.title.value,draggable:!1}},resultado.result&&resultado.result.length>0){$scope.claseAparcamiento="";for(var i in resultado.result){var result=resultado.result[i];$scope.markers["aloj"+result.id]={lat:Math.round10(result.geometry.coordinates[1],-4),lng:Math.round10(result.geometry.coordinates[0],-4),message:"<strong>"+result.title+"</strong>",icon:icono}}}else $scope.claseAparcamiento="glyphicon glyphicon-exclamation-sign"},function(){$scope.claseAparcamiento="glyphicon glyphicon-remove-circle"})},$scope.recursosCercanos=function(){$scope.claseRecurso="glyphicon glyphicon-refresh",Query.getApi("/recurso/urbanismo-infraestructuras/equipamiento/recurso?rows=200&fl=id,title,geometry&srsname=wgs84&point="+$scope.detalle.longitud.value+"%2C"+$scope.detalle.latitud.value+"&distance=1000").then(function(resultado){var icono={iconUrl:"//www.zaragoza.es/contenidos/iconos/recursos.png",iconSize:[22,22]};if($scope.markers={main_marker:{lat:Math.round10($scope.detalle.latitud.value,-4),lng:Math.round10($scope.detalle.longitud.value,-4),focus:!0,message:$scope.detalle.title.value,draggable:!1}},resultado.result&&resultado.result.length>0){$scope.claseRecurso="";for(var i in resultado.result){var result=resultado.result[i];$scope.markers["rec"+result.id]={lat:Math.round10(result.geometry.coordinates[1],-4),lng:Math.round10(result.geometry.coordinates[0],-4),message:"<strong>"+result.title+"</strong>",icon:icono}}}else $scope.claseRecurso="glyphicon glyphicon-exclamation-sign"},function(){$scope.claseRecurso="glyphicon glyphicon-remove-circle"})},$scope.$watch("registro.anyOldValue",function(value){if(value){var consultaDetalle;if($scope.registro.uri){if($scope.registro.uri.value){var uri=$scope.registro.uri.value;consultaDetalle=$filter("queryDetalle")($filter("tipo")(uri),$filter("identificador")(uri))}else{var identificador=$scope.registro.id.split("-")[1];consultaDetalle=$filter("queryDetalle")($scope.vocab,identificador)}""==consultaDetalle?Query.describe(uri).then(function(result){$scope.attrs=[],$scope.detalle=result}):Query.list(consultaDetalle).then(function(result){$scope.attrs=result.head.vars,$scope.detalle=result.results.bindings[0]})}else $scope.detalle=$scope.registro}})}]),angular.module("descubre.sector",["ngRoute","descubre.services","filtros","ui.bootstrap","ngMaterial"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/para/:idSector",{templateUrl:"sector/sector.html",controller:"SectorCtrl as ctrl"})}]).controller("SectorCtrl",["$scope","Query","$filter","$routeParams","$mdSidenav","$rootScope",function($scope,Query,$filter,$routeParams,$mdSidenav,$rootScope){$mdSidenav("left").close(),$scope.isCollapsed=!0;var sector=$routeParams.idSector,idSector="",idSectorActo="";"infancia"===sector?($scope.titleh2=$rootScope.strings.nav.child,idSector="18",idSectorActo="1"):"jovenes"===sector?($scope.titleh2=$rootScope.strings.nav.young,idSector="12",idSectorActo="2",this.menu=$rootScope.strings.sector.youth.menu):"mayores"===sector&&($scope.titleh2=$rootScope.strings.nav.elder,idSector="17",idSectorActo="3"),$scope.equipamientos=[];var params={};params.startRecurso=0,params.continua=!0,params.query=$rootScope.query.sector.events.format(idSectorActo),$scope.opt="event",$scope.mostrar=function(tipo,uri){$scope.isCollapsed=!0,$scope.opt=tipo,angular.isDefined(uri)?($scope.busy=!0,Query.getApi(uri).then(function(resultado){if(resultado.result&&resultado.result.length>0){$scope.equipamientos=[];for(var i in resultado.result){var result=resultado.result[i];$scope.equipamientos.push(result)}}},function(reason){alert("ERROR:"+reason)})):($scope.busy=!1,params.query="event"===tipo?$rootScope.query.sector.events.format(idSectorActo):$rootScope.query.sector.resources.format(idSector),params.startRecurso=0,$scope.equipamientos=[],$scope.loadMoreRecurso())},$scope.loadMoreRecurso=function(){return $scope.busy||!params.continua?void($scope.busy=!0):($scope.busy=!0,void Query.list(params.query+" OFFSET "+params.startRecurso+" LIMIT 50").then(function(result){$scope.busy=!1,$scope.equipamientos=$scope.equipamientos.concat(result.results.bindings),result.results.bindings.length>0?(params.startRecurso+=50,params.continua=!0):params.continua=!1}))}}]),angular.module("descubre.facet",["ngRoute","descubre.services","filtros","ngSanitize","infinite-scroll","ngMaterial"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/facet/:categoria",{templateUrl:"facet/facet.html",controller:"FacetCtrl as ctrl"})}]).controller("FacetCtrl",["$scope","Query","$filter","$routeParams","$rootScope","$mdSidenav",function($scope,Query,$filter,$routeParams,$rootScope,$mdSidenav){$mdSidenav("left").close();var categoria=$routeParams.categoria,faceta="",queryFacet="",queryDefecto="";$scope.busy=!1,"gastronomia"===categoria?(faceta='filter(?tipo="{0}") .',queryFacet=query.faceta.gastronomy.facet,queryDefecto=query.faceta.gastronomy.query,$scope.vocab="restaurante",$scope.titleh2=$rootScope.strings.nav.gastronomy):"agenda"===categoria?(faceta="?uri <http://www.w3.org/2006/vcard/ns#category> <{0}> .",queryFacet=query.faceta.events.facet,queryDefecto=query.faceta.events.query,$scope.vocab="evento",$scope.titleh2=$rootScope.strings.nav.events):"alojamiento"===categoria&&(faceta='?uri <http://vocab.linkeddata.es/datosabiertos/def/turismo/alojamiento#categoria> "{0}". ',queryFacet=query.faceta.accommodation.facet,queryDefecto=query.faceta.accommodation.query,$scope.vocab="alojamiento",$scope.titleh2=$rootScope.strings.nav.accommodation);var params={};params.start=0,$scope.filtroFaceta="",$scope.resultados=[],$scope.facetas=[],params.continua=!0,$scope.loadMore=function(){return $scope.busy||!params.continua?void($scope.busy=!0):(Query.list(queryDefecto.format($scope.filtroFaceta)+" OFFSET "+params.start+" LIMIT 50").then(function(result){$scope.resultados=$scope.resultados.concat(result.results.bindings),$scope.progresoCarga=$scope.progresoCarga+50,$scope.busy=!1,result.results.bindings.length>0?(params.start+=50,params.continua=!0):params.continua=!1}),void Query.list(queryFacet.format($scope.filtroFaceta)).then(function(result){$scope.facetas=result.results.bindings,$scope.progresoCarga=$scope.progresoCarga+50}))},$scope.filtrarFaceta=function(valor){console.log(valor),$scope.busy||(params.start=0,$scope.resultados=[],$scope.facetas=[],params.continua=!0,$scope.filtroFaceta=faceta.format(valor),$scope.loadMore())},$scope.borrarFiltros=function(){params.start=0,$scope.resultados=[],$scope.facetas=[],params.continua=!0,$scope.busy=!1,$scope.filtroFaceta="",$scope.loadMore()}}]),angular.module("descubre.buscar",["ngRoute","descubre.services","filtros","ngMaterial"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/buscar/:consulta",{templateUrl:"buscar/buscar.html",controller:"BuscarCtrl as ctrl"})}]).controller("BuscarCtrl",["$scope","Query","$filter","$routeParams","$mdSidenav","$rootScope",function($scope,Query,$filter,$routeParams,$mdSidenav,$rootScope){$scope.consulta=$routeParams.consulta,$mdSidenav("left").close();var cons=$scope.consulta.toLowerCase().trim();if(cons.indexOf(" ")>0){var arr=cons.split(" ");cons="";for(var i=0;i<arr.length;i++)cons=cons+"(?=.*"+arr[i]+")"}var params={};params.start=0,params.continua=!0,$scope.resultado=[],$scope.loadMore=function(){!$scope.busy&&params.continua&&($scope.busy=!0,Query.list($rootScope.query.search.format(cons,params.start)).then(function(result){$scope.busy=!1,$scope.resultado=$scope.resultado.concat(result.results.bindings),result.results.bindings.length>0?params.start+=50:params.continua=!1}))}}]),angular.module("descubre.version",["descubre.interpolate-filter","descubre.version-directive"]).value("version","0.1"),angular.module("descubre.version-directive",[]).directive("appVersion",["version",function(version){return function(scope,elm){elm.text(version)}}]),angular.module("descubre.interpolate-filter",[]).filter("interpolate",["version",function(version){return function(text){return String(text).replace(/\%VERSION\%/gm,version)}}]),angular.module("descubre.services",[]).factory("Query",["$http","$q",function($http,$q){var SPARQL_ENDPOINT="http://datos.zaragoza.es/sparql",API_ENDPOINT="http://www.zaragoza.es/api",SOLR_ENDPOINT="http://www.zaragoza.es/buscador/select?";return{list:function(query,graph){var deferred=$q.defer();return angular.isUndefined(graph)&&(graph=""),console.log(graph),console.log(query),$http.get(SPARQL_ENDPOINT+"?default-graph-uri="+encodeURIComponent(graph)+"&query="+encodeURIComponent(query)+"&format=application%2Fsparql-results%2Bjson&timeout=0").success(function(data){deferred.resolve(data)}).error(function(data){deferred.reject(data)}),deferred.promise},describe:function(uri,graph){var deferred=$q.defer();return angular.isUndefined(graph)&&(graph=""),$http.get(SPARQL_ENDPOINT+"?default-graph-uri="+encodeURIComponent(graph)+"&query=describe+"+encodeURIComponent("<"+uri+">")+"&format="+encodeURIComponent("application/x-json+ld")+"&timeout=0").success(function(data){deferred.resolve(data["@graph"][0])}).error(function(data){deferred.reject(data)}),deferred.promise},getSolr:function(query,category,facet,fq,start,rows){var deferred=$q.defer();return $http({method:"JSONP",url:SOLR_ENDPOINT,params:{"json.wrf":"JSON_CALLBACK",wt:"json",start:start||0,rows:rows||100,facet:"true","facet.field":facet,"facet.mincount":1,fl:"uri,title,id,texto_t,x_coordinate,y_coordinate,last_modified,temas_smultiple",q:query+" AND -tipocontenido_s:estatico AND category:"+category,fq:fq}}).success(function(data){deferred.resolve(data)}).error(function(data){deferred.reject(data)}),deferred.promise},getApi:function(uri){var deferred=$q.defer();return console.log(API_ENDPOINT+uri),$http.get(API_ENDPOINT+uri).success(function(data){deferred.resolve(data)}).error(function(data){deferred.reject(data)}),deferred.promise}}}]).factory("Agenda",["$filter",function($filter){function add(registro){console.log("add");var dato={};dato.uri=registro.uri?registro.uri.value||registro.uri:"punto-"+registro.id+"-mapa-colab",dato.title=registro.title.value||registro.title,dato.date=$filter("getDate")(registro),dato.startTime=$filter("getStartTime")(registro),dato.endTime=$filter("getEndTime")(registro),dato.latitud=$filter("getLatitud")(registro),dato.longitud=$filter("geLongitud")(registro);var items=JSON.parse(sessionStorage.getItem("items"))||{};items.dated||(items.dated={}),items.nodated||(items.nodated=[]),dato.date?(items.dated[dato.date]||(items.dated[dato.date]=[]),items.dated[dato.date].push(dato),items.dated[dato.date]=items.dated[dato.date].sort(function(a,b){return new Date(a.startTime)-new Date(b.startTime)})):items.nodated.push(dato),sessionStorage.setItem("items",JSON.stringify(items))}function remove(index,fecha,tipo){var items=JSON.parse(sessionStorage.getItem("items"))||{};console.log("borra");"dated"==tipo?(items.dated[fecha].splice(index,1),0==items.dated[fecha].length&&delete items.dated[fecha]):items.nodated.splice(index,1),sessionStorage.setItem("items",JSON.stringify(items))}function update(index,fecha,tipo,registro){remove(index,fecha,tipo),add(registro)}return{add:add,remove:remove,update:update,existe:function(registro){var uri="";uri=registro.uri?registro.uri.value||registro.uri:"punto-"+registro.id+"-mapa-colab";var items=sessionStorage.getItem("items")||"";return items.indexOf(uri)>=0},list:function(){return console.log("LLEGA"),JSON.parse(sessionStorage.getItem("items"))||[]}}}]),angular.module("descubre.directives",[]).directive("mostrarfecha",function($compile,$filter){function linker(scope,element,attrs){var registro=angular.fromJson(attrs.mostrarfecha),html="";registro.startDate?html=registro.endDate?registro.startDate.value===registro.endDate.value?$filter("parsedate")(registro.startDate.value):"Del "+$filter("parsedate")(registro.startDate.value)+" al "+$filter("parsedate")(registro.endDate.value):"Desde el "+$filter("parsedate")(registro.startDate.value):registro.endDate&&(html="Hasta el "+$filter("parsedate")(registro.endDate.value)),registro.startTime&&(html=html+" "+registro.startTime.value),registro.endTime&&(html=html+" "+registro.endTime.value),element.html(html),$compile(element.contents())(scope)}return{restrict:"A",link:linker}}).directive("contentItem",function($compile,$filter,$rootScope){var registro,getTemplate=function(contentType){var mapa='<leaflet center="center" markers="markers" height="280px" style="width:98%" layers="layers" geojson="geojson"></leaflet>                        '+$rootScope.strings.detail.near+':<br/>                         <button ng-click="actosCercanos()" class="btn btn-primary btn-xs"><span ng-show="claseActo" ng-class="claseActo"></span>'+$rootScope.strings.detail.events+'</button>                        <button ng-click="monumentosCercanos()" class="btn btn-primary btn-xs"><span ng-show="claseMonumento" ng-class="claseMonumento"></span>'+$rootScope.strings.detail.monuments+'</button>                        <button ng-click="restaurantesCercanos()" class="btn btn-primary btn-xs"><span ng-show="claseRestaurante" ng-class="claseRestaurante"></span> '+$rootScope.strings.detail.gastronomy+'</button>                        <button ng-click="alojamientosCercanos()" class="btn btn-primary btn-xs"><span ng-show="claseAlojamiento" ng-class="claseAlojamiento"></span>'+$rootScope.strings.detail.accommodation+'</button>                        <div class="btn-group dropup">                            <button type="button" class="btn btn-primary btn-xs dropdown-toggle" data-toggle="dropdown" aria-expanded="false">                                '+$rootScope.strings.detail.more+' <span class="caret"></span>                            </button>                        <ul class="dropdown-menu" role="menu">                            <li><a ng-click="sanidadCercanos()"><span ng-show="claseSanidad" ng-class="claseSanidad"></span>'+$rootScope.strings.detail.health+'</a></li>                            <li><a ng-click="recursosCercanos()"><span ng-show="claseRecurso" ng-class="claseRecurso"></span>'+$rootScope.strings.detail.resources+'</a></li>                            <li><a ng-click="aparcabiciCercanos()"><span ng-show="claseAparcabici" ng-class="claseAparcabici"></span> '+$rootScope.strings.detail.parking_bike+'</a></li>                            <li><a ng-click="biziCercanos()"><span ng-show="claseBizi" ng-class="claseBizi"></span> '+$rootScope.strings.detail.bizi+'</a></li>                            <li><a ng-click="paradaTaxiCercanos()"><span ng-show="claseParadaTaxi" ng-class="claseParadaTaxi"></span> '+$rootScope.strings.detail.taxi+'</a></li>                            <li><a ng-click="aparcamientoCercanos()"><span ng-show="claseAparcamiento" ng-class="claseAparcamiento"></span> '+$rootScope.strings.detail.public_parking+'</a></li>                            <li><a ng-click="motoCercanos()"><span ng-show="claseMoto" ng-class="claseMoto"></span> '+$rootScope.strings.detail.motorcycle_parking+'</a></li>                            <li><a ng-click="gasolineraCercanos()"><span ng-show="claseGasolinera" ng-class="claseGasolinera"></span> '+$rootScope.strings.detail.filling_station+"</a></li>                        </ul></div>",template="";switch(contentType){case"restaurante":template="<p>"+(registro.logo?'<img src="//www.zaragoza.es'+registro.logo.value+'" class="pull-right"/>':"")+(registro.comment?registro.comment.value:"")+"</p><p>"+(registro.capacidad?$rootScope.strings.detail.label.size+": "+registro.capacidad.value:"")+"</p><p>"+(registro.url?" "+$rootScope.strings.detail.label.web_site+': <a href="'+registro.url.value+'">'+registro.url.value+"</a>":"")+(registro.tel?" "+$rootScope.strings.detail.label.phone+": "+registro.tel.value:"")+(registro.email?" "+$rootScope.strings.detail.label.email+': <a href="mailto:'+registro.email.value+'">'+registro.email.value+"</a>":"")+(registro.streetAdr?"</p><p>"+$rootScope.strings.detail.label.address+": "+registro.streetAdr.value:"")+(registro.postCode?" "+$rootScope.strings.detail.label.postal_code+": "+registro.postCode.value:"")+(registro.addressLocality&&"Zaragoza"!==registro.addressLocality.value?" "+registro.addressLocality.value:"")+"</p>"+(registro.accesibilidad?"<p>"+registro.accesibilidad.value+"</p>":"")+(registro.photo?'<div><img src="//www.zaragoza.es'+registro.photo.value+'" height="100" class="center-block"/></div>':"")+(registro.latitud?mapa:"");break;case"evento":template="<p>"+(registro.image?'<img src="'+registro.image.value+'" class="pull-right" width="100"/>':"")+(registro.comment?registro.comment.value:"")+"</p>"+(registro.programa?"<p>"+$rootScope.strings.detail.label.program+": "+registro.programa.value+"</p>":"")+"<p>"+(registro.startDate?" "+$rootScope.strings.detail.label.start_date+": "+$filter("date")(registro.startDate.value,"dd-MM-yyyy"):"")+(registro.endDate?" "+$rootScope.strings.detail.label.end_date+": "+$filter("date")(registro.endDate.value,"dd-MM-yyyy"):"")+(registro.startTime?" "+$rootScope.strings.detail.label.start_time+": "+registro.startTime.value:"")+(registro.endTime?" "+$rootScope.strings.detail.label.end_time+": "+registro.endTime.value:"")+(registro.openingHours?" "+$rootScope.strings.detail.label.opening_hours+": "+registro.openingHours.value:"")+"</p><p>"+(registro.tipoEntrada?$rootScope.strings.detail.label.accession+": "+registro.tipoEntrada.value:"")+(registro.price?" "+$rootScope.strings.detail.label.price+": "+registro.price.value:"")+(registro.maxParticipantes?$rootScope.strings.detail.label.capacity+": "+registro.maxParticipantes.value:"")+"</p><p>"+(registro.url?" "+$rootScope.strings.detail.label.web_site+': <a href="'+registro.url.value+'">'+registro.url.value+"</a>":"")+(registro.tel?" "+$rootScope.strings.detail.label.phone+": "+registro.tel.value:"")+(registro.email?" "+$rootScope.strings.detail.label.email+': <a href="mailto:'+registro.email.value+'">'+registro.email.value+"</a>":"")+(registro.streetAdr?"</p><p>"+$rootScope.strings.detail.label.address+": "+registro.streetAdr.value:"")+(registro.postCode?" "+$rootScope.strings.detail.label.postal_code+": "+registro.postCode.value:"")+(registro.addressLocality&&"Zaragoza"!==registro.addressLocality.value?" "+registro.addressLocality.value:"")+"</p>"+(registro.accesibilidad?"<p>"+("S"===registro.accesibilidad.value?"Accesible para personas con movilidad reducida":"N"===registro.accesibilidad.value?"No accesible para personas con movilidad reducida":registro.accesibilidad.value)+"</p>":"")+(registro.latitud?mapa:"");break;case"monumento":template="<p>"+(registro.datacion?registro.datacion.value+". ":"")+(registro.estilo?registro.estilo.value+". ":"")+(registro.comment?registro.comment.value:"")+"</p><p>"+(registro.horario?$rootScope.strings.detail.label.opening_hours+". "+registro.horario.value:"")+(registro.price?" "+$rootScope.strings.detail.label.price+". "+registro.price.value:"")+(registro.uso?" "+$rootScope.strings.detail.label.use+". "+registro.uso.value:"")+"</p>"+(registro.puntosInteres?"<p><strong>"+$rootScope.strings.detail.label.pois+"</strong>. "+registro.puntosInteres.value+"</p>":"")+(registro.detalleVisita?"<p><strong>"+$rootScope.strings.detail.label.visit+"</strong>. "+registro.detalleVisita.value+"</p>":"")+"<p>"+(registro.tel?" "+$rootScope.strings.detail.label.phone+": "+registro.tel.value:"")+(registro.fax?" "+$rootScope.strings.detail.label.fax+": "+registro.fax.value:"")+(registro.streetAdr?"</p><p>"+$rootScope.strings.detail.label.address+": "+registro.streetAdr.value:"")+(registro.datosAcceso?" "+$rootScope.strings.detail.label.access+": "+registro.datosAcceso.value:"")+"</p>"+(registro.accesibilidad?"<p>"+registro.accesibilidad.value+"</p>":"")+(registro.photo?'<div><img src="'+registro.photo.value+'" height="100" class="center-block"/></div>':"")+(registro.latitud?mapa:"");break;case"alojamiento":template="<p>"+(registro.logo?'<img src="//www.zaragoza.es'+registro.logo.value+'" class="pull-right"/>':"")+(registro.comment?registro.comment.value:"")+"</p><p>"+(registro.numCamas&&registro.numCamas.value>0?registro.numCamas.value+" camas ":"")+(registro.numHabitaciones&&registro.numHabitaciones.value>0?" "+registro.numHabitaciones.value+" habitaciones":"")+"</p><p>"+(registro.url?" "+$rootScope.strings.detail.label.web_site+': <a href="'+registro.url.value+'">'+registro.url.value+"</a>":"")+(registro.tel?" "+$rootScope.strings.detail.label.phone+": "+registro.tel.value:"")+(registro.fax?" "+$rootScope.strings.detail.label.fax+": "+registro.fax.value:"")+(registro.email?" "+$rootScope.strings.detail.label.email+': <a href="mailto:'+registro.email.value+'">'+registro.email.value+"</a>":"")+(registro.streetAdr?"</p><p>"+$rootScope.strings.detail.label.address+": "+registro.streetAdr.value:"")+(registro.postCode?" "+$rootScope.strings.detail.label.postal_code+": "+registro.postCode.value:"")+(registro.addressLocality&&"Zaragoza"!==registro.addressLocality.value?" "+registro.addressLocality.value:"")+"</p>"+(registro.accesibilidad?"<p>"+registro.accesibilidad.value+"</p>":"")+(registro.photo?'<div><img src="//www.zaragoza.es'+registro.photo.value+'" height="100" class="center-block"/></div>':"")+(registro.latitud?mapa:"");break;case"recurso":template="<p>"+(registro.comment?registro.comment.value:"")+(registro.servicios?registro.servicios.value:"")+"</p>"+(registro.url?"<p>"+$rootScope.strings.detail.label.web_site+': <a href="'+registro.url.value+'">'+registro.url.value+"</a></p>":"")+"<p>"+(registro.horario?$rootScope.strings.detail.label.opening_hours+". "+registro.horario.value:"")+(registro.price?" "+$rootScope.strings.detail.label.price+". "+registro.price.value:"")+"</p><p>"+(registro.tel?" "+$rootScope.strings.detail.label.phone+": "+registro.tel.value:"")+(registro.email?" "+$rootScope.strings.detail.label.email+': <a href="mailto:'+registro.email.value+'">'+registro.email.value+"</a>":"")+(registro.streetAdr?"</p><p>"+$rootScope.strings.detail.label.address+": "+registro.streetAdr.value:"")+"</p>"+(registro.accesibilidad?"<p>"+registro.accesibilidad.value+"</p>":"")+(registro.latitud?mapa:"");break;case"mapa-colaborativo":template="<p>"+registro.description+"</p>"+(registro.link?'<p>Sitio web: <a href="'+registro.link+'">'+registro.link+"</a></p>":"")+(registro.latitud?mapa:"");break;default:template='<dl class="dl-horizontal">';for(var prop in registro)template=template+"<dt>"+$filter("propiedad")(prop)+"</dt><dd>"+$filter("valor")(registro[prop])+"</dd>";template+="</dl>"}return" <md-content>"+template+"</md-content>"},linker=function(scope,element,attrs){scope.$watch(attrs.content,function(value){if(value){registro=value,!registro.latitud&&registro.geometry&&(registro.latitud={},registro.longitud={},registro.latitud.value=registro.geometry.coordinates[1],registro.longitud.value=registro.geometry.coordinates[0]),registro.latitud&&registro.longitud&&(scope.center={lat:Math.round10(registro.latitud.value,-4),lng:Math.round10(registro.longitud.value,-4),zoom:14},scope.markers={main_marker:{lat:Math.round10(registro.latitud.value,-4),lng:Math.round10(registro.longitud.value,-4),focus:!0,message:registro.title.value||registro.title,title:registro.title.value||registro.title,draggable:!1}},scope.geojson={},scope.layers={baselayers:{wms:{name:"IDEzar",type:"wms",visible:!0,url:"http://idezar.zaragoza.es/wms/IDEZar_base/IDEZar_base",layerParams:{crs:L.CRS.EPSG4326,layers:"base",format:"image/png",transparent:!1,attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>,  &copy; <a href="http://www.zaragoza.es/">Ayuntamiento de Zaragoza</a>'}},xyz:{name:"OpenStreetMap (XYZ)",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz"}}});var uriObj="";registro.uri&&(uriObj=registro.uri.value||registro.uri),element.html(getTemplate($filter("tipo")(uriObj)||attrs.type)),$compile(element.contents())(scope)}})};return{restrict:"E",link:linker}}),function(){function decimalAdjust(type,value,exp){return"undefined"==typeof exp||0===+exp?Math[type](value):(value=+value,exp=+exp,isNaN(value)||"number"!=typeof exp||exp%1!==0?0/0:(value=value.toString().split("e"),value=Math[type](+(value[0]+"e"+(value[1]?+value[1]-exp:-exp))),value=value.toString().split("e"),+(value[0]+"e"+(value[1]?+value[1]+exp:exp))))}Math.round10||(Math.round10=function(value,exp){return decimalAdjust("round",value,exp)}),Math.floor10||(Math.floor10=function(value,exp){return decimalAdjust("floor",value,exp)}),Math.ceil10||(Math.ceil10=function(value,exp){return decimalAdjust("ceil",value,exp)})}(),String.prototype.format||(String.prototype.format=function(){var args=arguments;return this.replace(/{(\d+)}/g,function(match,number){return"undefined"!=typeof args[number]?args[number]:match})}),angular.module("filtros",[]).filter("propiedad",function(){return function(input){return input.indexOf("#")>0?input.substr(input.lastIndexOf("#")+1,input.length):input.indexOf("/")>0?input.substr(input.lastIndexOf("/")+1,input.length):input}}).filter("identificador",function(){return function(input){return input.indexOf("#")>0?input.substr(input.lastIndexOf("#")+1,input.length):input.indexOf("/")>0?input.substr(input.lastIndexOf("/")+1,input.length):input}}).filter("tipo",function(){return function(uri){return uri.indexOf("/api/recurso/cultura-ocio/evento-zaragoza")>=0?"evento":uri.indexOf("/api/recurso/turismo/monumento")>=0?"monumento":uri.indexOf("/api/recurso/turismo/restaurante")>=0?"restaurante":uri.indexOf("/api/recurso/turismo/alojamiento")>=0?"alojamiento":uri.indexOf("/api/recurso/urbanismo-infraestructuras/equipamiento/recurso")>=0?"recurso":""}}).filter("queryDetalle",function(){return function(vocab,id){return"restaurante"===vocab?query.filter.restaurante.format(id):"monumento"===vocab?query.filter.monumento.format(id):"evento"===vocab?query.filter.evento.format(id):"recurso"===vocab?query.filter.recurso.format(id):"alojamiento"===vocab?query.filter.alojamiento.format(id):""}}).filter("getDate",function(){return function(registro){return registro.date?registro.date.value?registro.date.value:registro.date:registro.startDate?registro.startDate.value?registro.startDate.value:registro.startDate:registro.endDate?registro.endDate.value?registro.endDate.value:registro.endDate:void 0}}).filter("getStartTime",function(){return function(registro){return registro.startTime?registro.startTime.value?registro.startTime.value:registro.startTime:void 0}}).filter("getEndTime",function(){return function(registro){return registro.endTime?registro.endTime.value?registro.endTime.value:registro.endTime:void 0}}).filter("getLatitud",function(){return function(registro){return registro.latitud?registro.latitud.value?registro.latitud.value:registro.latitud:registro.geometry?registro.geometry.coordinates[1]:void 0}}).filter("geLongitud",function(){return function(registro){return registro.longitud?registro.longitud.value?registro.longitud.value:registro.longitud:registro.geometry?registro.geometry.coordinates[0]:void 0}}).filter("parsedate",function($filter){return function(input){var fec=input.split("-"),parseYear=" yyyy";return(new Date).getFullYear()==fec[0]&&(parseYear=""),$filter("date")(input,"EEEE dd MMMM"+parseYear)}}).filter("valor",function(){return function(input){return Array.isArray(input)?"string"==typeof input[0]||input[0]instanceof String?input:input[0]["@value"]:input?input.value?input.value:input:""}});